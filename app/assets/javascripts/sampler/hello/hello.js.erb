//= depend_on_asset "hello/hello.html"
"use strict";
angular
  .module('sampler.hello', ['ui.router', 'sampler.auth'])
  .config(function($stateProvider) {
    $stateProvider
      .state("hello", {
        url: "/hello",
        templateUrl: "<%= asset_path('hello/hello.html') %>",
        controller: 'HelloController'
      });
  })
  .controller(
    'HelloController',
    function(
      $scope,
      $http,
      AuthenticationService) {
    $scope.server = {
      url: 'http://localhost:3000',
      method: 'GET',
      api: '/api/test',
      login_api: '/api/login',
      query: '',
      username: '',
      password: ''
    };
    $scope.user = {
      username: 'test',
      password: 'password'
    };

    $scope.data = {
      hello: 'Aamua',
      world: 'Mualima'
    };
    $scope.api = {
      data: '-',
      status: '-',
      headers: '-',
      config: '-'
    };

    $scope.login = function() {
      AuthenticationService.login(
        $scope.server.url,
        $scope.user.username,
        $scope.user.password,
        $scope.server.login_api);
    };

    $scope.logout = function() {
      AuthenticationService.logout($scope.server.login_api);
    };

    $scope.changeHello = function() {
      $scope.data.hello = 'Iltapäevää';
      console.log("start call");
      var s = $scope.server;
      var url = s.url + s.api + s.query;
      console.log(url);
      console.log(s);
      $http( {method: s.method, url: url, withCredentials: true})
        .success(function(data, status, headers, config) {
          $scope.api = {
            data: data,
            status: status,
            headers: headers,
            config: config
          };
        })
        .error(function(data, status, headers, config) {
          $scope.api = {
            data: data,
            status: status,
            headers: headers,
            config: config
          };
          window.open(url);
        });
    };

    $scope.rollbackHello = function() {
      $scope.data.hello = 'Uamua';
      $scope.api = {
        data: '-',
        status: '-',
        headers: '-',
        config: '-'
      };
    };
  });
