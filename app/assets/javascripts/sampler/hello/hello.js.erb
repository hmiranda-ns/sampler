//= depend_on_asset "hello/hello.html"
"use strict";
angular
  .module('sampler.hello', ['ui.router', 'sampler.auth'])
  .config(function($stateProvider) {
    $stateProvider
      .state("hello", {
        url: "/hello",
        templateUrl: "<%= asset_path('hello/hello.html') %>",
        controller: 'HelloController'
      });
  })
  .controller(
    'HelloController',
    function(
      $scope,
      $http,
      AuthenticationService) {
    $scope.server = {
      url: AuthenticationService.getUrl(),
      method: 'GET',
      api: '/api/test',
      payload: ''
    };
    $scope.api = {
      data: '-',
      status: '-',
      headers: '-',
      config: '-'
    };

    $scope.call = function() {
      console.log("start call");
      var s = $scope.server;
      var url = s.url + s.api + s.payload;
      console.log(url);
      console.log(s);
      $http( {method: s.method, url: url, withCredentials: true})
        .success(function(data, status, headers, config) {
          $scope.api = {
            data: data,
            status: status,
            headers: headers,
            config: config
          };
        })
        .error(function(data, status, headers, config) {
          $scope.api = {
            data: data,
            status: status,
            headers: headers,
            config: config
          };
          window.open(url);
        });
    };

    $scope.clear = function() {
      $scope.api = {
        data: '-',
        status: '-',
        headers: '-',
        config: '-'
      };
    };
  });
