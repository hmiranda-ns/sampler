"use strict";
angular
  .module('sampler', [
    'ui.router',
    'ngAnimate',
    'restangular',
    'ngCookies',
    'ng-auth',
    'ng-auth.strategies.basic',
    'sampler.root',
    'sampler.home',
    'sampler.login',
    'sampler.user',
    'sampler.tasks'
  ])
  .run(function ($rootScope,   $state,   $stateParams) {
    $rootScope.$state = $state;
    $rootScope.$stateParams = $stateParams;
  })
  .config(function(
    $httpProvider,
    $locationProvider,
    RestangularProvider,
    $stateProvider,
    $urlRouterProvider,
    authProvider) {
    $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
    $locationProvider.html5Mode(true);

    RestangularProvider.setDefaultHttpFields({withCredentials: true});

    authProvider.register('basic', {
      strategy: 'basic'
    });

    $urlRouterProvider
      .when("/?path", ['$match', function ($match) {
        return "/" + $match['path'];
      }])
      .otherwise('/home');

    $stateProvider
      .state('root.about', {
        url: '/about',
        templateUrl: "<%= asset_path('about.html') %>"
      });
  });
